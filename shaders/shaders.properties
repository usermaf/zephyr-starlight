iris.features.required = SSBO CUSTOM_IMAGES

profile.FANCY = PRIMARY_GI_SAMPLES=1 SHADOW_SAMPLES=2 REFLECTION_SAMPLES=1 SUNLIGHT_GI_QUALITY=1 VOXELIZE_ENTITIES !VOXELIZE_BLOCK_ENTITIES !VOXELIZE_PLAYER !VOXELIZE_ITEMS SMOOTH_IRC CHROMATIC_ABERRATION_SAMPLES=8
profile.FAST  = PRIMARY_GI_SAMPLES=1 SHADOW_SAMPLES=1 REFLECTION_SAMPLES=1 SUNLIGHT_GI_QUALITY=0 !VOXELIZE_ENTITIES !VOXELIZE_BLOCK_ENTITIES !VOXELIZE_PLAYER !VOXELIZE_ITEMS !SMOOTH_IRC CHROMATIC_ABERRATION_SAMPLES=4

screen.columns = 1
screen = MAIN_TITLE <profile> <empty> [PATH_TRACING] [ATMOSPHERICS] [TERRAIN] [ANTIALIASING] [POST_PROCESSING] [MISC]

screen.VOXEL_ADVANCED.columns = 2
screen.VOXEL_ADVANCED = VOXEL_ARRAY_SIZE VOXEL_PROBE_ATTEMPTS shadowMapResolution TEXTURE_HASH_ENTRIES TRIANGLE_ARRAY_SIZE  

screen.PT_VOXELIZATION.columns = 1
screen.PT_VOXELIZATION = VOXELIZATION_DISTANCE entityShadowDistanceMul <empty> VOXELIZE_ENTITIES VOXELIZE_BLOCK_ENTITIES VOXELIZE_PLAYER VOXELIZE_ITEMS <empty> [VOXEL_ADVANCED]

screen.PT_IRCACHE.columns = 2
screen.PT_IRCACHE = IRC_VOXEL_ARRAY_SIZE IRC_PROBE_ATTEMPTS IRC_UPDATE_INTERVAL IRC_MAX_RT_DISTANCE

screen.PT_DIFFUSE.columns = 1
screen.PT_DIFFUSE = PRIMARY_GI_SAMPLES DIFFUSE_MAX_RT_DISTANCE PT_DIFFUSE_ACCUMULATION_LIMIT <empty> SUNLIGHT_GI_QUALITY 

screen.PT_REFLECTION.columns = 1
screen.PT_REFLECTION = REFLECTION_SAMPLES REFLECTION_MAX_RT_DISTANCE PT_REFLECTION_ACCUMULATION_LIMIT <empty> REFLECTION_ROUGHNESS_THRESHOLD

screen.PT_SHADOW.columns = 1
screen.PT_SHADOW = SHADOW_SAMPLES SHADOW_MAX_RT_DISTANCE PT_SHADOW_ACCUMULATION_LIMIT <empty> SUN_SIZE

screen.PT_DENOISING.columns = 1
screen.PT_DENOISING = DENOISER_DEPTH_WEIGHT DENOISER_NORMAL_WEIGHT DENOISER_SHARPENING

screen.PATH_TRACING.columns = 2
screen.PATH_TRACING = [PT_VOXELIZATION] [PT_IRCACHE] <empty> <empty> [PT_DIFFUSE] [PT_REFLECTION] [PT_SHADOW] [PT_DENOISING] <empty> <empty> SMOOTH_IRC NOISE_METHOD

screen.ATMOSPHERICS.columns = 2
screen.TERRAIN.columns = 2

screen.ATMOSPHERICS = sunPathRotation SUN_AZIMUTH_ROTATION <empty> <empty> SKY_MIE SKY_OZONE NIGHT_BRIGHTNESS 
screen.TERRAIN = NORMAL_MAPPING SPECULAR_MAPPING <empty> <empty> EMISSION_BRIGHTNESS GLASS_REFLECTANCE IPBR

screen.ANTIALIASING.columns = 2
screen.ANTIALIASING = TAA TAA_UPSCALING_FACTOR <empty> <empty> TAA_JITTER_SCALE TAA_VARIANCE_WEIGHT TAA_OFFCENTER_WEIGHT TAA_ACCUMULATION_LIMIT TAA_MIP_BIAS SHARPENING

screen.POST_PROCESSING.columns = 2
screen.POST_PROCESSING = DYNAMIC_EXPOSURE ADAPTATION_SPEED MANUAL_EXPOSURE SATURATION CHROMATIC_ABERRATION CHROMATIC_ABERRATION_SAMPLES

screen.MISC = RT_TRACING_EYE DEBUG_IRC HAND_FOV DISABLE_DENOISING FORCE_TRIANGLE_TRACING 

#screen =    <profile> PT_DIFFUSE_ACCUMULATION_LIMIT PT_REFLECTION_ACCUMULATION_LIMIT VOXELIZATION_DISTANCE PRIMARY_GI_SAMPLES SHADOW_SAMPLES \
#            TAA RESPONSIVE_TAA DEBUG_IRC TAA_MIP_BIAS FORCE_TRIANGLE_TRACING IPBR REFLECTION_SAMPLES DISABLE_DENOISING \
#            EMISSION_BRIGHTNESS TAA_JITTER_SCALE NIGHT_BRIGHTNESS IRC_VOXEL_ARRAY_SIZE IRC_PROBE_ATTEMPTS TRIANGLE_ARRAY_SIZE \
#            TAA_UPSCALING_FACTOR VOXEL_ARRAY_SIZE VOXELIZE_ENTITIES VOXELIZE_BLOCK_ENTITIES VOXELIZE_PLAYER VOXELIZE_ITEMS SUN_AZIMUTH_ROTATION

sliders = PRIMARY_GI_SAMPLES SHADOW_SAMPLES REFLECTION_SAMPLES VOXELIZATION_DISTANCE PT_DIFFUSE_ACCUMULATION_LIMIT PT_REFLECTION_ACCUMULATION_LIMIT PT_SHADOW_ACCUMULATION_LIMIT \
          DIFFUSE_MAX_RT_DISTANCE REFLECTION_MAX_RT_DISTANCE SHADOW_MAX_RT_DISTANCE SUN_SIZE REFLECTION_ROUGHNESS_THRESHOLD VOXEL_ARRAY_SIZE VOXEL_PROBE_ATTEMPTS shadowMapResolution \
          TEXTURE_HASH_ENTRIES TRIANGLE_ARRAY_SIZE sunPathRotation SUN_AZIMUTH_ROTATION SKY_MIE SKY_OZONE NIGHT_BRIGHTNESS EMISSION_BRIGHTNESS GLASS_REFLECTANCE TAA_JITTER_SCALE \
          TAA_VARIANCE_WEIGHT TAA_OFFCENTER_WEIGHT TAA_ACCUMULATION_LIMIT TAA_MIP_BIAS TAA_UPSCALING_FACTOR HAND_FOV DENOISER_DEPTH_WEIGHT DENOISER_NORMAL_WEIGHT DENOISER_SHARPENING \
          entityShadowDistanceMul IRC_VOXEL_ARRAY_SIZE IRC_PROBE_ATTEMPTS IRC_UPDATE_INTERVAL IRC_MAX_RT_DISTANCE MANUAL_EXPOSURE CONTRAST SATURATION SHARPENING CHROMATIC_ABERRATION \
          CHROMATIC_ABERRATION_SAMPLES ADAPTATION_SPEED

blend.gbuffers_water = off
blend.gbuffers_hand_water = off
blend.gbuffers_beaconbeam = off

rain.depth = true 
beacon.beam.depth = false

oldLighting = false
sky = false
stars = true

shadow.enabled = true
shadow.culling = false

allowConcurrentCompute = true

#ifndef VOXELIZE_ENTITIES
    shadowEntities = false
#endif

#ifndef VOXELIZE_BLOCK_ENTITIES
    shadowBlockEntities = false
#endif

#ifndef VOXELIZE_PLAYER
    shadowPlayer = false
#endif

shadowLightBlockEntities = true

particles.ordering = before

#if TAA_UPSCALING_FACTOR == 100
    size.buffer.colortex0 = 1.0 1.0
    size.buffer.colortex2 = 1.0 1.0
    size.buffer.colortex3 = 1.0 1.0
    size.buffer.colortex4 = 1.0 1.0
    size.buffer.colortex5 = 1.0 1.0
    size.buffer.colortex7 = 1.0 1.0
#elif TAA_UPSCALING_FACTOR == 75
    size.buffer.colortex0 = 0.75 0.75
    size.buffer.colortex2 = 0.75 0.75
    size.buffer.colortex3 = 0.75 0.75
    size.buffer.colortex4 = 0.75 0.75
    size.buffer.colortex5 = 0.75 0.75
    size.buffer.colortex7 = 0.75 0.75
#elif TAA_UPSCALING_FACTOR == 50
    size.buffer.colortex0 = 0.5 0.5
    size.buffer.colortex2 = 0.5 0.5
    size.buffer.colortex3 = 0.5 0.5
    size.buffer.colortex4 = 0.5 0.5
    size.buffer.colortex5 = 0.5 0.5
    size.buffer.colortex7 = 0.5 0.5
#endif

# triangles

#if TRIANGLE_ARRAY_SIZE == 1048576
    bufferObject.0 = 50331652
#elif TRIANGLE_ARRAY_SIZE == 2097152
    bufferObject.0 = 100663300
#elif TRIANGLE_ARRAY_SIZE == 3145728
    bufferObject.0 = 150994948
#elif TRIANGLE_ARRAY_SIZE == 4194304
    bufferObject.0 = 201326596
#elif TRIANGLE_ARRAY_SIZE == 8388608
    bufferObject.0 = 402653188
#elif TRIANGLE_ARRAY_SIZE == 16777216
    bufferObject.0 = 805306372
#endif

# texture data
bufferObject.1 = 67117064

# irradiance cache

#if IRC_VOXEL_ARRAY_SIZE == 32768
    bufferObject.2 = 1048576
#elif IRC_VOXEL_ARRAY_SIZE == 49152
    bufferObject.2 = 1572864
#elif IRC_VOXEL_ARRAY_SIZE == 65536
    bufferObject.2 = 2097152
#elif IRC_VOXEL_ARRAY_SIZE == 98304
    bufferObject.2 = 3145728
#elif IRC_VOXEL_ARRAY_SIZE == 131072
    bufferObject.2 = 4194304
#elif IRC_VOXEL_ARRAY_SIZE == 262144
    bufferObject.2 = 8388608
#endif

# voxel data

#if VOXEL_ARRAY_SIZE == 65536
    bufferObject.3 = 524288
#elif VOXEL_ARRAY_SIZE == 1048576
    bufferObject.3 = 8388608
#elif VOXEL_ARRAY_SIZE == 2097152
    bufferObject.3 = 16777216
#elif VOXEL_ARRAY_SIZE == 4194304
    bufferObject.3 = 33554432
#elif VOXEL_ARRAY_SIZE == 8388608
    bufferObject.3 = 67108864
#elif VOXEL_ARRAY_SIZE == 16777216
    bufferObject.3 = 134217728
#endif

bufferObject.4 = 1310720 texture/HeitzData_1spp.bin
bufferObject.5 = 4

#ifndef TAA
    program.composite1.enabled = false
#endif

#ifndef DYNAMIC_EXPOSURE
    program.composite5.enabled = false
    program.setup3.enabled = false
#endif

#ifdef DISABLE_DENOISING
    program.deferred2.enabled = false
    program.deferred3.enabled = false
    program.deferred4.enabled = false
    program.deferred5.enabled = false
    program.deferred6.enabled = false
    program.deferred7.enabled = false
    program.deferred8.enabled = false
    program.deferred9.enabled = false
    program.deferred14.enabled = false
    program.deferred15.enabled = false
    program.deferred16.enabled = false
    program.deferred17.enabled = false
    program.deferred21.enabled = false
    program.deferred22.enabled = false
    program.deferred23.enabled = false
    program.deferred24.enabled = false
    program.deferred25.enabled = false
    program.deferred26.enabled = false
    program.deferred27.enabled = false
    program.deferred28.enabled = false
#endif

texture.composite.shadowtex0 = minecraft:textures/atlas/blocks.png
texture.deferred.shadowtex0 = minecraft:textures/atlas/blocks.png
texture.prepare.shadowtex0 = minecraft:textures/atlas/blocks.png
texture.begin.shadowtex0 = minecraft:textures/atlas/blocks.png

texture.composite.shadowtex1 = minecraft:textures/atlas/blocks_s.png
texture.deferred.shadowtex1 = minecraft:textures/atlas/blocks_s.png
texture.prepare.shadowtex1 = minecraft:textures/atlas/blocks_s.png
texture.begin.shadowtex1 = minecraft:textures/atlas/blocks_s.png

# https://discordapp.com/channels/237199950235041794/525510804494221312/1416364500591837216

texture.composite.noisetex = texture/stbn.bin TEXTURE_3D RGB8 128 128 64 RGB UNSIGNED_BYTE
texture.deferred.noisetex = texture/stbn.bin TEXTURE_3D RGB8 128 128 64 RGB UNSIGNED_BYTE
texture.prepare.noisetex = texture/stbn.bin TEXTURE_3D RGB8 128 128 64 RGB UNSIGNED_BYTE
texture.begin.noisetex = texture/stbn.bin TEXTURE_3D RGB8 128 128 64 RGB UNSIGNED_BYTE

#if VOXELIZATION_DISTANCE == 32
    image.voxelBufferLod = voxelSamplerLod red_integer r8ui unsigned_byte true false 64 32 32
#elif VOXELIZATION_DISTANCE == 64
    image.voxelBufferLod = voxelSamplerLod red_integer r8ui unsigned_byte true false 128 64 64
#elif VOXELIZATION_DISTANCE == 128
    image.voxelBufferLod = voxelSamplerLod red_integer r8ui unsigned_byte true false 256 96 128
#elif VOXELIZATION_DISTANCE == 192 
    image.voxelBufferLod = voxelSamplerLod red_integer r8ui unsigned_byte true false 384 128 192
#elif VOXELIZATION_DISTANCE == 256 
    image.voxelBufferLod = voxelSamplerLod red_integer r8ui unsigned_byte true false 512 128 256
#else
    image.voxelBufferLod = voxelSamplerLod red_integer r8ui unsigned_byte true false 1024 128 512
#endif

image.imgTransmittance = texTransmittance rgba rgb10_a2 unsigned_int_2_10_10_10_rev false false 32 32
image.imgWorley = texWorley red r8 unsigned_byte false false 64 64 64
image.imgSkyView = texSkyView rgb r11f_g11f_b10f unsigned_int_10f_11f_11f_rev false false 32 32

variable.float.voxelOffset_x = fmod(((cameraPositionInt.x % 8) - 4) + cameraPositionFract.x, 8.0) - 4.0
variable.float.voxelOffset_y = fmod(((cameraPositionInt.y % 8) - 4) + cameraPositionFract.y, 8.0) - 4.0
variable.float.voxelOffset_z = fmod(((cameraPositionInt.z % 8) - 4) + cameraPositionFract.z, 8.0) - 4.0

uniform.vec3.voxelOffset = vec3(voxelOffset_x, voxelOffset_y, voxelOffset_z)

variable.float.cameraVelocity_x = floor(cameraPositionInt.x - previousCameraPositionInt.x) + (cameraPositionFract.x - previousCameraPositionFract.x)
variable.float.cameraVelocity_y = floor(cameraPositionInt.y - previousCameraPositionInt.y) + (cameraPositionFract.y - previousCameraPositionFract.y)
variable.float.cameraVelocity_z = floor(cameraPositionInt.z - previousCameraPositionInt.z) + (cameraPositionFract.z - previousCameraPositionFract.z)

uniform.vec3.cameraVelocity = vec3(cameraVelocity_x, cameraVelocity_y, cameraVelocity_z)

variable.float.sunDir_x = gbufferModelViewInverse.0.0 * sunPosition.x + gbufferModelViewInverse.1.0 * sunPosition.y + gbufferModelViewInverse.2.0 * sunPosition.z
variable.float.sunDir_y = gbufferModelViewInverse.0.1 * sunPosition.x + gbufferModelViewInverse.1.1 * sunPosition.y + gbufferModelViewInverse.2.1 * sunPosition.z
variable.float.sunDir_z = gbufferModelViewInverse.0.2 * sunPosition.x + gbufferModelViewInverse.1.2 * sunPosition.y + gbufferModelViewInverse.2.2 * sunPosition.z
variable.float.sunDirNorm = 1.0 / sqrt((sunDir_x * sunDir_x) + (sunDir_y * sunDir_y) + (sunDir_z * sunDir_z))

variable.float.sunDirNorm_x = (sunDir_x * cos(torad(SUN_AZIMUTH_ROTATION)) + sunDir_z * sin(torad(SUN_AZIMUTH_ROTATION))) * sunDirNorm
variable.float.sunDirNorm_y = sunDir_y * sunDirNorm
variable.float.sunDirNorm_z = (sunDir_z * cos(torad(SUN_AZIMUTH_ROTATION)) - sunDir_x * sin(torad(SUN_AZIMUTH_ROTATION))) * sunDirNorm

variable.float.moonDir_x = gbufferModelViewInverse.0.0 * moonPosition.x + gbufferModelViewInverse.1.0 * moonPosition.y + gbufferModelViewInverse.2.0 * moonPosition.z
variable.float.moonDir_y = gbufferModelViewInverse.0.1 * moonPosition.x + gbufferModelViewInverse.1.1 * moonPosition.y + gbufferModelViewInverse.2.1 * moonPosition.z
variable.float.moonDir_z = gbufferModelViewInverse.0.2 * moonPosition.x + gbufferModelViewInverse.1.2 * moonPosition.y + gbufferModelViewInverse.2.2 * moonPosition.z
variable.float.moonDirNorm = 1.0 / sqrt((moonDir_x * moonDir_x) + (moonDir_y * moonDir_y) + (moonDir_z * moonDir_z))

variable.float.moonDirNorm_x = (moonDir_x * cos(torad(SUN_AZIMUTH_ROTATION)) + moonDir_z * sin(torad(SUN_AZIMUTH_ROTATION))) * moonDirNorm
variable.float.moonDirNorm_y = moonDir_y * moonDirNorm
variable.float.moonDirNorm_z = (moonDir_z * cos(torad(SUN_AZIMUTH_ROTATION)) - moonDir_x * sin(torad(SUN_AZIMUTH_ROTATION))) * moonDirNorm

uniform.vec3.shadowDir = vec3(if(sunAngle == shadowAngle, sunDirNorm_x, moonDirNorm_x), if(sunAngle == shadowAngle, sunDirNorm_y, moonDirNorm_y), if(sunAngle == shadowAngle, sunDirNorm_z, moonDirNorm_z))
uniform.vec3.moonDir = vec3(moonDirNorm_x, moonDirNorm_y, moonDirNorm_z)
uniform.vec3.sunDir = vec3(sunDirNorm_x, sunDirNorm_y, sunDirNorm_z)

variable.float.renderSize_x = ceil(0.01 * TAA_UPSCALING_FACTOR * viewWidth)
variable.float.renderSize_y = ceil(0.01 * TAA_UPSCALING_FACTOR * viewHeight)

variable.float.texelSize_x = 1.0 / renderSize_x
variable.float.texelSize_y = 1.0 / renderSize_y

uniform.vec2.renderSize = vec2(renderSize_x, renderSize_y)
uniform.vec2.texelSize = vec2(texelSize_x, texelSize_y)

variable.float.gbufferModelViewProjection0_x = gbufferProjection.0.0 * gbufferModelView.0.0 + gbufferProjection.1.0 * gbufferModelView.0.1 + gbufferProjection.2.0 * gbufferModelView.0.2
variable.float.gbufferModelViewProjection0_y = gbufferProjection.0.1 * gbufferModelView.0.0 + gbufferProjection.1.1 * gbufferModelView.0.1 + gbufferProjection.2.1 * gbufferModelView.0.2
variable.float.gbufferModelViewProjection0_z = gbufferProjection.0.2 * gbufferModelView.0.0 + gbufferProjection.1.2 * gbufferModelView.0.1 + gbufferProjection.2.2 * gbufferModelView.0.2
variable.float.gbufferModelViewProjection0_w = gbufferProjection.0.3 * gbufferModelView.0.0 + gbufferProjection.1.3 * gbufferModelView.0.1 + gbufferProjection.2.3 * gbufferModelView.0.2

variable.float.gbufferModelViewProjection1_x = gbufferProjection.0.0 * gbufferModelView.1.0 + gbufferProjection.1.0 * gbufferModelView.1.1 + gbufferProjection.2.0 * gbufferModelView.1.2
variable.float.gbufferModelViewProjection1_y = gbufferProjection.0.1 * gbufferModelView.1.0 + gbufferProjection.1.1 * gbufferModelView.1.1 + gbufferProjection.2.1 * gbufferModelView.1.2
variable.float.gbufferModelViewProjection1_z = gbufferProjection.0.2 * gbufferModelView.1.0 + gbufferProjection.1.2 * gbufferModelView.1.1 + gbufferProjection.2.2 * gbufferModelView.1.2
variable.float.gbufferModelViewProjection1_w = gbufferProjection.0.3 * gbufferModelView.1.0 + gbufferProjection.1.3 * gbufferModelView.1.1 + gbufferProjection.2.3 * gbufferModelView.1.2

variable.float.gbufferModelViewProjection2_x = gbufferProjection.0.0 * gbufferModelView.2.0 + gbufferProjection.1.0 * gbufferModelView.2.1 + gbufferProjection.2.0 * gbufferModelView.2.2
variable.float.gbufferModelViewProjection2_y = gbufferProjection.0.1 * gbufferModelView.2.0 + gbufferProjection.1.1 * gbufferModelView.2.1 + gbufferProjection.2.1 * gbufferModelView.2.2
variable.float.gbufferModelViewProjection2_z = gbufferProjection.0.2 * gbufferModelView.2.0 + gbufferProjection.1.2 * gbufferModelView.2.1 + gbufferProjection.2.2 * gbufferModelView.2.2
variable.float.gbufferModelViewProjection2_w = gbufferProjection.0.3 * gbufferModelView.2.0 + gbufferProjection.1.3 * gbufferModelView.2.1 + gbufferProjection.2.3 * gbufferModelView.2.2

variable.float.gbufferModelViewProjection3_x = gbufferProjection.0.0 * gbufferModelView.3.0 + gbufferProjection.1.0 * gbufferModelView.3.1 + gbufferProjection.2.0 * gbufferModelView.3.2 + gbufferProjection.3.0
variable.float.gbufferModelViewProjection3_y = gbufferProjection.0.1 * gbufferModelView.3.0 + gbufferProjection.1.1 * gbufferModelView.3.1 + gbufferProjection.2.1 * gbufferModelView.3.2 + gbufferProjection.3.1
variable.float.gbufferModelViewProjection3_z = gbufferProjection.0.2 * gbufferModelView.3.0 + gbufferProjection.1.2 * gbufferModelView.3.1 + gbufferProjection.2.2 * gbufferModelView.3.2 + gbufferProjection.3.2
variable.float.gbufferModelViewProjection3_w = gbufferProjection.0.3 * gbufferModelView.3.0 + gbufferProjection.1.3 * gbufferModelView.3.1 + gbufferProjection.2.3 * gbufferModelView.3.2 + gbufferProjection.3.3

uniform.vec4.gbufferModelViewProjection0 = vec4(gbufferModelViewProjection0_x, gbufferModelViewProjection0_y, gbufferModelViewProjection0_z, gbufferModelViewProjection0_w)
uniform.vec4.gbufferModelViewProjection1 = vec4(gbufferModelViewProjection1_x, gbufferModelViewProjection1_y, gbufferModelViewProjection1_z, gbufferModelViewProjection1_w)
uniform.vec4.gbufferModelViewProjection2 = vec4(gbufferModelViewProjection2_x, gbufferModelViewProjection2_y, gbufferModelViewProjection2_z, gbufferModelViewProjection2_w)
uniform.vec4.gbufferModelViewProjection3 = vec4(gbufferModelViewProjection3_x, gbufferModelViewProjection3_y, gbufferModelViewProjection3_z, gbufferModelViewProjection3_w)

variable.float.gbufferModelViewProjectionInverse0_x = gbufferModelViewInverse.0.0 * gbufferProjectionInverse.0.0 + gbufferModelViewInverse.1.0 * gbufferProjectionInverse.0.1 + gbufferModelViewInverse.2.0 * gbufferProjectionInverse.0.2 + gbufferModelViewInverse.3.0 * gbufferProjectionInverse.0.3
variable.float.gbufferModelViewProjectionInverse0_y = gbufferModelViewInverse.0.1 * gbufferProjectionInverse.0.0 + gbufferModelViewInverse.1.1 * gbufferProjectionInverse.0.1 + gbufferModelViewInverse.2.1 * gbufferProjectionInverse.0.2 + gbufferModelViewInverse.3.1 * gbufferProjectionInverse.0.3
variable.float.gbufferModelViewProjectionInverse0_z = gbufferModelViewInverse.0.2 * gbufferProjectionInverse.0.0 + gbufferModelViewInverse.1.2 * gbufferProjectionInverse.0.1 + gbufferModelViewInverse.2.2 * gbufferProjectionInverse.0.2 + gbufferModelViewInverse.3.2 * gbufferProjectionInverse.0.3

variable.float.gbufferModelViewProjectionInverse1_x = gbufferModelViewInverse.0.0 * gbufferProjectionInverse.1.0 + gbufferModelViewInverse.1.0 * gbufferProjectionInverse.1.1 + gbufferModelViewInverse.2.0 * gbufferProjectionInverse.1.2 + gbufferModelViewInverse.3.0 * gbufferProjectionInverse.1.3
variable.float.gbufferModelViewProjectionInverse1_y = gbufferModelViewInverse.0.1 * gbufferProjectionInverse.1.0 + gbufferModelViewInverse.1.1 * gbufferProjectionInverse.1.1 + gbufferModelViewInverse.2.1 * gbufferProjectionInverse.1.2 + gbufferModelViewInverse.3.1 * gbufferProjectionInverse.1.3
variable.float.gbufferModelViewProjectionInverse1_z = gbufferModelViewInverse.0.2 * gbufferProjectionInverse.1.0 + gbufferModelViewInverse.1.2 * gbufferProjectionInverse.1.1 + gbufferModelViewInverse.2.2 * gbufferProjectionInverse.1.2 + gbufferModelViewInverse.3.2 * gbufferProjectionInverse.1.3

variable.float.gbufferModelViewProjectionInverse2_x = gbufferModelViewInverse.0.0 * gbufferProjectionInverse.2.0 + gbufferModelViewInverse.1.0 * gbufferProjectionInverse.2.1 + gbufferModelViewInverse.2.0 * gbufferProjectionInverse.2.2 + gbufferModelViewInverse.3.0 * gbufferProjectionInverse.2.3
variable.float.gbufferModelViewProjectionInverse2_y = gbufferModelViewInverse.0.1 * gbufferProjectionInverse.2.0 + gbufferModelViewInverse.1.1 * gbufferProjectionInverse.2.1 + gbufferModelViewInverse.2.1 * gbufferProjectionInverse.2.2 + gbufferModelViewInverse.3.1 * gbufferProjectionInverse.2.3
variable.float.gbufferModelViewProjectionInverse2_z = gbufferModelViewInverse.0.2 * gbufferProjectionInverse.2.0 + gbufferModelViewInverse.1.2 * gbufferProjectionInverse.2.1 + gbufferModelViewInverse.2.2 * gbufferProjectionInverse.2.2 + gbufferModelViewInverse.3.2 * gbufferProjectionInverse.2.3

variable.float.gbufferModelViewProjectionInverse3_x = gbufferModelViewInverse.0.0 * gbufferProjectionInverse.3.0 + gbufferModelViewInverse.1.0 * gbufferProjectionInverse.3.1 + gbufferModelViewInverse.2.0 * gbufferProjectionInverse.3.2 + gbufferModelViewInverse.3.0 * gbufferProjectionInverse.3.3
variable.float.gbufferModelViewProjectionInverse3_y = gbufferModelViewInverse.0.1 * gbufferProjectionInverse.3.0 + gbufferModelViewInverse.1.1 * gbufferProjectionInverse.3.1 + gbufferModelViewInverse.2.1 * gbufferProjectionInverse.3.2 + gbufferModelViewInverse.3.1 * gbufferProjectionInverse.3.3
variable.float.gbufferModelViewProjectionInverse3_z = gbufferModelViewInverse.0.2 * gbufferProjectionInverse.3.0 + gbufferModelViewInverse.1.2 * gbufferProjectionInverse.3.1 + gbufferModelViewInverse.2.2 * gbufferProjectionInverse.3.2 + gbufferModelViewInverse.3.2 * gbufferProjectionInverse.3.3 

uniform.vec4.gbufferModelViewProjectionInverse0 = vec4(gbufferModelViewProjectionInverse0_x, gbufferModelViewProjectionInverse0_y, gbufferModelViewProjectionInverse0_z, gbufferProjectionInverse.0.3)
uniform.vec4.gbufferModelViewProjectionInverse1 = vec4(gbufferModelViewProjectionInverse1_x, gbufferModelViewProjectionInverse1_y, gbufferModelViewProjectionInverse1_z, gbufferProjectionInverse.1.3)
uniform.vec4.gbufferModelViewProjectionInverse2 = vec4(gbufferModelViewProjectionInverse2_x, gbufferModelViewProjectionInverse2_y, gbufferModelViewProjectionInverse2_z, gbufferProjectionInverse.2.3)
uniform.vec4.gbufferModelViewProjectionInverse3 = vec4(gbufferModelViewProjectionInverse3_x, gbufferModelViewProjectionInverse3_y, gbufferModelViewProjectionInverse3_z, gbufferProjectionInverse.3.3)

variable.float.gbufferPreviousModelViewProjection0_x = gbufferPreviousProjection.0.0 * gbufferPreviousModelView.0.0 + gbufferPreviousProjection.1.0 * gbufferPreviousModelView.0.1 + gbufferPreviousProjection.2.0 * gbufferPreviousModelView.0.2
variable.float.gbufferPreviousModelViewProjection0_y = gbufferPreviousProjection.0.1 * gbufferPreviousModelView.0.0 + gbufferPreviousProjection.1.1 * gbufferPreviousModelView.0.1 + gbufferPreviousProjection.2.1 * gbufferPreviousModelView.0.2
variable.float.gbufferPreviousModelViewProjection0_z = gbufferPreviousProjection.0.2 * gbufferPreviousModelView.0.0 + gbufferPreviousProjection.1.2 * gbufferPreviousModelView.0.1 + gbufferPreviousProjection.2.2 * gbufferPreviousModelView.0.2
variable.float.gbufferPreviousModelViewProjection0_w = gbufferPreviousProjection.0.3 * gbufferPreviousModelView.0.0 + gbufferPreviousProjection.1.3 * gbufferPreviousModelView.0.1 + gbufferPreviousProjection.2.3 * gbufferPreviousModelView.0.2

variable.float.gbufferPreviousModelViewProjection1_x = gbufferPreviousProjection.0.0 * gbufferPreviousModelView.1.0 + gbufferPreviousProjection.1.0 * gbufferPreviousModelView.1.1 + gbufferPreviousProjection.2.0 * gbufferPreviousModelView.1.2
variable.float.gbufferPreviousModelViewProjection1_y = gbufferPreviousProjection.0.1 * gbufferPreviousModelView.1.0 + gbufferPreviousProjection.1.1 * gbufferPreviousModelView.1.1 + gbufferPreviousProjection.2.1 * gbufferPreviousModelView.1.2
variable.float.gbufferPreviousModelViewProjection1_z = gbufferPreviousProjection.0.2 * gbufferPreviousModelView.1.0 + gbufferPreviousProjection.1.2 * gbufferPreviousModelView.1.1 + gbufferPreviousProjection.2.2 * gbufferPreviousModelView.1.2
variable.float.gbufferPreviousModelViewProjection1_w = gbufferPreviousProjection.0.3 * gbufferPreviousModelView.1.0 + gbufferPreviousProjection.1.3 * gbufferPreviousModelView.1.1 + gbufferPreviousProjection.2.3 * gbufferPreviousModelView.1.2

variable.float.gbufferPreviousModelViewProjection2_x = gbufferPreviousProjection.0.0 * gbufferPreviousModelView.2.0 + gbufferPreviousProjection.1.0 * gbufferPreviousModelView.2.1 + gbufferPreviousProjection.2.0 * gbufferPreviousModelView.2.2
variable.float.gbufferPreviousModelViewProjection2_y = gbufferPreviousProjection.0.1 * gbufferPreviousModelView.2.0 + gbufferPreviousProjection.1.1 * gbufferPreviousModelView.2.1 + gbufferPreviousProjection.2.1 * gbufferPreviousModelView.2.2
variable.float.gbufferPreviousModelViewProjection2_z = gbufferPreviousProjection.0.2 * gbufferPreviousModelView.2.0 + gbufferPreviousProjection.1.2 * gbufferPreviousModelView.2.1 + gbufferPreviousProjection.2.2 * gbufferPreviousModelView.2.2
variable.float.gbufferPreviousModelViewProjection2_w = gbufferPreviousProjection.0.3 * gbufferPreviousModelView.2.0 + gbufferPreviousProjection.1.3 * gbufferPreviousModelView.2.1 + gbufferPreviousProjection.2.3 * gbufferPreviousModelView.2.2

variable.float.gbufferPreviousModelViewProjection3_x = gbufferPreviousProjection.0.0 * gbufferPreviousModelView.3.0 + gbufferPreviousProjection.1.0 * gbufferPreviousModelView.3.1 + gbufferPreviousProjection.2.0 * gbufferPreviousModelView.3.2 + gbufferPreviousProjection.3.0
variable.float.gbufferPreviousModelViewProjection3_y = gbufferPreviousProjection.0.1 * gbufferPreviousModelView.3.0 + gbufferPreviousProjection.1.1 * gbufferPreviousModelView.3.1 + gbufferPreviousProjection.2.1 * gbufferPreviousModelView.3.2 + gbufferPreviousProjection.3.1
variable.float.gbufferPreviousModelViewProjection3_z = gbufferPreviousProjection.0.2 * gbufferPreviousModelView.3.0 + gbufferPreviousProjection.1.2 * gbufferPreviousModelView.3.1 + gbufferPreviousProjection.2.2 * gbufferPreviousModelView.3.2 + gbufferPreviousProjection.3.2
variable.float.gbufferPreviousModelViewProjection3_w = gbufferPreviousProjection.0.3 * gbufferPreviousModelView.3.0 + gbufferPreviousProjection.1.3 * gbufferPreviousModelView.3.1 + gbufferPreviousProjection.2.3 * gbufferPreviousModelView.3.2 + gbufferPreviousProjection.3.3

uniform.vec4.gbufferPreviousModelViewProjection0 = vec4(gbufferPreviousModelViewProjection0_x, gbufferPreviousModelViewProjection0_y, gbufferPreviousModelViewProjection0_z, gbufferPreviousModelViewProjection0_w)
uniform.vec4.gbufferPreviousModelViewProjection1 = vec4(gbufferPreviousModelViewProjection1_x, gbufferPreviousModelViewProjection1_y, gbufferPreviousModelViewProjection1_z, gbufferPreviousModelViewProjection1_w)
uniform.vec4.gbufferPreviousModelViewProjection2 = vec4(gbufferPreviousModelViewProjection2_x, gbufferPreviousModelViewProjection2_y, gbufferPreviousModelViewProjection2_z, gbufferPreviousModelViewProjection2_w)
uniform.vec4.gbufferPreviousModelViewProjection3 = vec4(gbufferPreviousModelViewProjection3_x, gbufferPreviousModelViewProjection3_y, gbufferPreviousModelViewProjection3_z, gbufferPreviousModelViewProjection3_w)

uniform.float.frameRate = 1.0 / frameTime
uniform.float.lightBrightness = if(sunAngle == shadowAngle, 1.0, NIGHT_BRIGHTNESS) * (1.0 - 0.7 * rainStrength)

#ifdef TAA
    # 8 rooks TAA jitter (https://discordapp.com/channels/237199950235041794/1124181688566681701/1423954401852264531)

    variable.int.framemod8 = floor(8.0 * frac(frameCounter * 0.6180339))
    variable.int.framemod8prev = floor(8.0 * frac((frameCounter - 1) * 0.6180339))

    uniform.vec2.taaOffset = vec2(  \
        (if(                        \
            framemod8 == 0,  0.125, \
            framemod8 == 1, -0.125, \
            framemod8 == 2, -0.875, \
            framemod8 == 3,  0.875, \
            framemod8 == 4, -0.625, \
            framemod8 == 5,  0.625, \
            framemod8 == 6, -0.375, \
            framemod8 == 7,  0.375, \
            0.0) / viewWidth),      \
        (if(                        \
            framemod8 == 0, -0.875, \
            framemod8 == 1,  0.875, \
            framemod8 == 2, -0.375, \
            framemod8 == 3,  0.375, \
            framemod8 == 4, -0.125, \
            framemod8 == 5,  0.125, \
            framemod8 == 6,  0.625, \
            framemod8 == 7, -0.625, \
            0.0) / viewHeight)      \
    )

    uniform.vec2.taaOffsetPrev = vec2(  \
        (if(                        \
            framemod8prev == 0,  0.125, \
            framemod8prev == 1, -0.125, \
            framemod8prev == 2, -0.875, \
            framemod8prev == 3,  0.875, \
            framemod8prev == 4, -0.625, \
            framemod8prev == 5,  0.625, \
            framemod8prev == 6, -0.375, \
            framemod8prev == 7,  0.375, \
            0.0) / viewWidth),      \
        (if(                        \
            framemod8prev == 0, -0.875, \
            framemod8prev == 1,  0.875, \
            framemod8prev == 2, -0.375, \
            framemod8prev == 3,  0.375, \
            framemod8prev == 4, -0.125, \
            framemod8prev == 5,  0.125, \
            framemod8prev == 6,  0.625, \
            framemod8prev == 7, -0.625, \
            0.0) / viewHeight)      \
    )
#else
    uniform.vec2.taaOffset = vec2(0.0, 0.0)
    uniform.vec2.taaOffsetPrev = vec2(0.0, 0.0)
#endif